name: Build Windows 32-bit

on:
  workflow_dispatch:
  push:
    branches: [ main ]

jobs:
  build-windows-32bit:
    runs-on: windows-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Setup MSYS2
      uses: msys2/setup-msys2@v2
      with:
        msystem: MINGW32
        update: true
        install: >-
          mingw-w64-i686-gcc
          mingw-w64-i686-glew
          mingw-w64-i686-SDL2
          make
          git
          python3
          unzip
    
    - name: Check ROM
      shell: msys2 {0}
      run: |
        if [ ! -f "baserom.us.z64" ]; then
          echo "âŒ ERROR: baserom.us.z64 no encontrado"
          exit 1
        fi
        echo "âœ… ROM encontrada"
        sha1sum baserom.us.z64
    
    - name: Compile sm64coopdx
      shell: msys2 {0}
      run: |
        echo "ğŸ”¨ Compilando para Windows 32-bit..."
        make TARGET_BITS=32 DISCORD_SDK=0 -j4
    
    - name: Package build
      shell: msys2 {0}
      run: |
        echo "ğŸ“¦ Empaquetando archivos..."
        mkdir -p sm64coopdx-win32
        cp build/us_pc/sm64coopdx.exe sm64coopdx-win32/
        cp -r res sm64coopdx-win32/
        cp -r lang sm64coopdx-win32/
        cp -r mods sm64coopdx-win32/ 2>/dev/null || true
        
        # Copiar DLLs necesarias
        ldd build/us_pc/sm64coopdx.exe | grep mingw | awk '{print $3}' | xargs -I {} cp {} sm64coopdx-win32/ || true
    
    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: sm64coopdx-windows-32bit
        path: sm64coopdx-win32/
        retention-days: 30
```

5. **En "Name", cÃ¡mbiale el nombre** a: `.github/workflows/build-win32.yml`

6. Haz clic en **"Commit changes..."**

7. Selecciona **"Commit directly to the main branch"**

8. Haz clic en **"Commit changes"**

---

### PASO 4: Ejecutar la CompilaciÃ³n

1. **Ve a la pestaÃ±a "Actions"** de tu repositorio

2. En la barra lateral izquierda, verÃ¡s **"Build Windows 32-bit"**

3. Haz clic en ese workflow

4. Haz clic en el botÃ³n **"Run workflow"** (botÃ³n azul en el lado derecho)

5. AsegÃºrate que diga "Branch: main" y haz clic en **"Run workflow"**

ğŸ‰ Â¡La compilaciÃ³n ha comenzado!

---

### PASO 5: Monitorear el Progreso

1. VerÃ¡s aparecer una nueva ejecuciÃ³n con un cÃ­rculo amarillo girando

2. Haz clic en ella para ver los detalles

3. Haz clic en **"build-windows-32bit"** para ver los logs en tiempo real

4. VerÃ¡s 5 pasos ejecutÃ¡ndose:
   - âœ… Checkout repository (~10 segundos)
   - âœ… Setup MSYS2 (~3-5 minutos)
   - âœ… Check ROM (~5 segundos)
   - âœ… Compile sm64coopdx (~8-12 minutos) â±ï¸ **Este es el mÃ¡s largo**
   - âœ… Package build (~30 segundos)
   - âœ… Upload artifact (~1 minuto)

â±ï¸ **Tiempo total estimado: 15-20 minutos**

---

### PASO 6: Descargar tu Ejecutable

Una vez que todos los pasos tengan âœ… verde:

1. **Baja hasta el final** de la pÃ¡gina de la ejecuciÃ³n

2. VerÃ¡s una secciÃ³n **"Artifacts"**

3. Haz clic en **"sm64coopdx-windows-32bit"**

4. Se descargarÃ¡ un archivo ZIP (~50-100 MB)

5. **Descomprime el ZIP** en tu PC

6. **Dentro encontrarÃ¡s:**
```
   sm64coopdx-win32/
   â”œâ”€â”€ sm64coopdx.exe          â† Tu ejecutable
   â”œâ”€â”€ SDL2.dll
   â”œâ”€â”€ glew32.dll
   â”œâ”€â”€ libgcc_s_dw2-1.dll
   â”œâ”€â”€ libstdc++-6.dll
   â”œâ”€â”€ libwinpthread-1.dll
   â”œâ”€â”€ res/                     â† Recursos del juego
   â”œâ”€â”€ lang/                    â† Traducciones
   â””â”€â”€ mods/                    â† Carpeta de mods
